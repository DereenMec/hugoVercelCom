---
title: "CppPrimer08.IOåº“"
date: 2020-04-29T11:20:09+08:00
lastmod: 2020-04-29T11:20:09+08:00
draft: true
tags: [C++, å­¦ä¹ ç¬”è®°]
categories: [C++ Primer å­¦ä¹ ç¬”è®°]
author: "Dereen"
comment: true
toc: true
autoCollapseToc: false
---



<!--more-->

## IOç±»

æ ‡å‡†åº“å®šä¹‰çš„IOç±»å‹å¦‚ä¸‹è¡¨ï¼Œå®ƒä»¬åˆ†åˆ«åœ¨ä¸‰ä¸ªå¤´æ–‡ä»¶ä¸­ï¼š

| å¤´æ–‡ä»¶   | ç±»å‹                                                         |
| -------- | ------------------------------------------------------------ |
| iostream | `istream`ï¼Œ `wistream`ä»æµè¯»å–æ•°æ®<br />`ostream`ï¼Œ `ostream`å‘æµå†™å…¥æ•°æ®<br />`iostream`ï¼Œ`wiostream`è¯»å†™æµ |
| fstream  | `ifstream`ï¼Œ`wifstream`ä»æ–‡ä»¶è¯»å–æ•°æ®<br />`ofstream`ï¼Œ`wofstream`å‘æ–‡ä»¶å†™å…¥æ•°æ®<br />`fstream`ï¼Œ`wfstream`è¯»å†™æ–‡ä»¶ |
| sstream  | `istringstream`ï¼Œ`wistringstream`ä»stringè¯»å–æ•°æ®<br />`ostringstream`ï¼Œ`wostringstream`å‘stringå†™å…¥æ•°æ®<br />`stringstream`ï¼Œ`wstringstream`è¯»å†™string |

**è¿™äº›IOç±»å‹ä¹‹é—´æ˜¯ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥è¿™äº›ç±»å‹ä¹‹é—´æœ‰è®¸å¤šæ“ä½œæ˜¯é€šç”¨çš„ï¼Œä¾‹å¦‚<<ã€>>è¡¨è¾¾å¼ï¼Œgetlineå‡½æ•°ã€‚**

### IOå¯¹è±¡æ— æ‹·è´æˆ–èµ‹å€¼

ç”±äºä¸èƒ½æ‹·è´IOå¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½å°†å½¢å‚æˆ–è¿”å›ç±»å‹è®¾ç½®ä¸ºæµç±»å‹ã€‚è¿›è¡ŒIOæ“ä½œçš„å‡½æ•°é€šå¸¸ä»¥å¼•ç”¨æ–¹å¼ä¼ é€’å’Œè¿”å›æµã€‚**è¯»å†™ä¸€ä¸ªIOå¯¹è±¡ä¼šæ”¹å˜å…¶çŠ¶æ€ï¼Œå› æ­¤ä¼ é€’å’Œè¿”å›çš„å¼•ç”¨ä¸èƒ½æ˜¯constçš„ã€‚**

### æ¡ä»¶çŠ¶æ€

IOæ“ä½œä¸€ä¸ªä¸ç”Ÿä¿±æ¥çš„é—®é¢˜æ˜¯å¯èƒ½å‘ç”Ÿé”™è¯¯ï¼Œå…¶ä¸­æœ‰çš„æ˜¯å¯ä¿®å¤çš„æœ‰çš„å‘ç”Ÿåœ¨ç³»ç»Ÿæ·±å¤„ï¼Œç‚’å‡ºæ¥åº”ç”¨ç¨‹åºå¯ä¿®æ­£çš„èŒƒå›´ã€‚ä¸‹æ ‡åˆ—å‡ºäº†IOç±»æ‰€å®šä¹‰çš„ä¸€äº›**å‡½æ•°å’Œæ ‡å¿—**ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¿é—®å’Œæ“çºµæµçš„**æ¡ä»¶çŠ¶æ€**ã€‚ä¸‹è¡¨ä¸­çš„strmæ˜¯ä¸Šä¸ªè¡¨æ ¼ä¸­æ‰€åˆ—å‡ºçš„ä»»æ„ä¸€ç§IOç±»å‹ã€‚

| å‡½æ•°åŠæ ‡å¿—          | å«ä¹‰                                                         |
| ------------------- | ------------------------------------------------------------ |
| `strm::iostate`     | iostateæ˜¯ä¸€ç§æœºå™¨ç›¸å…³çš„ç±»å‹ï¼Œæä¾›äº†è¡¨è¾¾æ¡ä»¶çŠ¶æ€çš„å®Œæ•´åŠŸèƒ½ã€‚  |
| `strm::badbit`      | ç”¨æ¥æŒ‡å‡ºæµå·²å´©æºƒ                                             |
| `strm::failbit`     | ç”¨æ¥æŒ‡å‡ºä¸€ä¸ªIOæ“ä½œå¤±è´¥äº†                                     |
| `strm::eofbit`      | ç”¨æ¥æŒ‡å‡ºæµåˆ°è¾¾äº†æ–‡ä»¶æœ«                                       |
| `strm::goodbit`     | ç”¨æ¥æŒ‡å‡ºæµæœªå¤„äºé”™è¯¯çŠ¶æ€ã€‚æ­¤å€¼ä¿è¯ä¸º0                        |
| `s.eof()`           | å¦‚æœæµçš„eofbitç½®ä½ï¼Œè¿”å›true                                 |
| `s.fail()`          | å¦‚æœæµçš„failbitç½®ä½ï¼Œè¿”å›true                                |
| `s.bad()`           | å¦‚æœæµçš„badbitç½®ä½ï¼Œè¿”å›true                                 |
| `s.good()`          | å¦‚æœæµçš„goodbitç½®ä½ï¼Œè¿”å›true                                |
| `s.clear()`         | å°†æµsä¸­æ‰€æœ‰æ¡ä»¶çŠ¶æ€å¤ä½ï¼Œå°†æµçš„çŠ¶æ€è®¾ç½®ä¸ºæœ‰æ•ˆã€‚è¿”å›void      |
| `s.clear(flags)`    | æ ¹æ®ç»™å®šçš„flagsæ ‡å¿—ä½ï¼Œå°†æµsä¸­å¯¹åº”æ¡ä»¶çŠ¶æ€ä½å¤ä½ã€‚flagsçš„ç±»å‹ä¸ºstrm::iostateã€‚è¿”å›void |
| `s.setstate(flags)` | æ ¹æ®ç»™å®šçš„flagsæ ‡å¿—ä½ï¼Œå°†æµsä¸­å¯¹åº”æ¡ä»¶çŠ¶æ€ä½ç½®ä½ã€‚flagsçš„ç±»å‹ä¸ºstrm::iostateã€‚è¿”å›void |
| `s.rdstate()`       | è¿”å›æµsçš„å½“å‰çŠ¶æ€ï¼Œè¿”å›å€¼ç±»å‹ä¸ºstrm::iostate                 |

ç¡®å®šä¸€ä¸ªæµå¯¹è±¡çš„çŠ¶æ€æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†ä»–å½“ä½œæ¡ä»¶ä½¿ç”¨ï¼Œä¾‹å¦‚`while(cin >> s)`ã€‚**å°†æµä½œä¸ºæ¡ä»¶ä½¿ç”¨ï¼Œåªèƒ½å‘Šè¯‰æˆ‘ä»¬æµæ˜¯å¦æœ‰æ•ˆï¼Œè€Œæ— æ³•å‘Šè¯‰æˆ‘ä»¬å…·ä½“å‘ç”Ÿäº†ä»€ä¹ˆã€‚**

IOåº“å®šä¹‰äº†ä¸€ä¸ªä¸æœºå™¨ç›¸å…³çš„iostateç±»å‹ï¼Œå®ƒå¯ä»¥é…åˆä¸Šè¡¨ä¸­IOåº“å®šä¹‰çš„å››ä¸ªå¸¸é‡è¿›è¡Œä½è¿ç®—æ¥åˆ¤æ–­æµçš„å…·ä½“çŠ¶æ€ï¼Œä½¿ç”¨æ–¹æ³•ç±»ä¼¼äºä¹‹å‰æˆ‘ä»¬é‡åˆ°çš„[quizç»ƒä¹ ](https://happy.dereen.top/post/cppprimer_chapter04/#%E4%BD%8D%E4%B8%8E-%E4%BD%8D%E6%88%96-%E4%BD%8D%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97%E7%AC%A6)ã€‚ä¾‹å­ï¼š

```cpp
auto old_state = cin.rdstate();           // è®°ä½cinçš„å½“å‰çŠ¶æ€
cin.clear();                              // ä½¿cinæœ‰æ•ˆ
process_input(cin);                       // ä½¿ç”¨cin
cin.setstate(old_state);                  // å°†cinç½®ä¸ºåŸå§‹çŠ¶æ€
// å¤ä½failbitå’Œbadbitï¼Œå…¶ä»–ä½ä¿æŒä¸å˜
cin.clear(cin.rdstate() & ~cin.failbit & ~cin.badbit);
```

### ç®¡ç†è¾“å‡ºç¼“å†²

æ¯ä¸ªè¾“å‡ºæµéƒ½ç®¡ç†ä¸€ä¸ªç¼“å†²åŒºï¼Œç”¨æ¥ä¿å­˜ç¨‹åºè¯»å†™çš„æ•°æ®ã€‚å¯¼è‡´ç¼“å†²åˆ·æ–°çš„åŸå› æœ‰å¾ˆå¤šï¼š

- ç¨‹åºæ­£å¸¸ç»“æŸï¼Œä½œä¸ºmainå‡½æ•°çš„returnæ“ä½œçš„ä¸€éƒ¨åˆ†ï¼Œç¼“å†²åˆ·æ–°è¢«æ‰§è¡Œï¼›
- ç¼“å†²åŒºæ»¡äº†ï¼›
- ä½¿ç”¨æ“çºµç¬¦endlæ¥æ˜¾å¼çš„åˆ·æ–°ç¼“å†²åŒºï¼›
- åœ¨æ¯ä¸ªè¾“å‡ºæ“ä½œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ“ä½œç¬¦unitbufè®¾ç½®æµçš„å†…éƒ¨çŠ¶æ€ï¼Œæ¥æ¸…ç©ºç¼“å†²åŒºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œcerræ˜¯è®¾ç½®unitbufçš„ï¼Œæ‰€ä»¥å†™åˆ°cerr çš„å†…å®¹éƒ½ä¼šè¢«ç«‹å³è¾“å‡ºï¼›
- ä¸€ä¸ªè¾“å‡ºæµå¯èƒ½è¢«å…³è”åˆ°å¦ä¸€ä¸ªæµã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“è¯»å†™å¦ä¸€ä¸ªæµæ—¶ï¼Œè¿™ä¸ªè¾“å‡ºæµä¹Ÿä¼šè¢«åˆ·æ–°ï¼Œä¾‹å¦‚coutæ˜¯è¢«å…³è”åˆ°cerrå’Œcin çš„ã€‚å½“æˆ‘ä»¬è°ƒç”¨cerrå’Œcinæ—¶ï¼Œcoutå°±ä¼šè¢«åˆ·æ–°ã€‚

#### åˆ·æ–°è¾“å‡ºç¼“å†²åŒº

é™¤äº†endlï¼ŒIOåº“ä¸­è¿˜æœ‰ä¸¤ä¸ªç±»ä¼¼çš„æ“çºµç¬¦ï¼šflushå’Œendsã€‚flushåˆ·æ–°ç¼“å†²åŒºä¸”ä¸è¾“å‡ºä»»ä½•é¢å¤–å­—ç¬¦ã€‚endsè¾“å‡ºå†…å®¹å’Œä¸€ä¸ªé¢å¤–çš„ç©ºæ ¼ã€‚

```cpp
cout << "Ni" << flush;
cout << "Ni" << ends;
```

#### unitbufæ“çºµç¬¦

å¦‚æœæƒ³åœ¨æ¯æ¬¡è¾“å‡ºæ“ä½œåéƒ½åˆ·æ–°ç¼“å†²åŒºï¼Œå¯ä»¥ä½¿ç”¨unifbufæ“çºµç¬¦ï¼Œä½¿ç”¨å®Œåä½¿ç”¨nounitbufé‡ç½®ã€‚

```cpp
cout << unitbuf;
cout << " sd sd";           // ä¼šç«‹å³è¾“å‡º
cout << nounitbuf;
```

#### å…³è”è¾“å…¥å’Œè¾“å‡ºæµ

å½“ä¸€ä¸ªè¾“å…¥æµè¢«å…³è”åˆ°ä¸€ä¸ªè¾“å‡ºæµæ—¶ï¼Œä»»ä½•è¯•å›¾ä»è¾“å…¥æµè¯»å–æ•°æ®çš„æ“ä½œéƒ½ä¼šé¦–å…ˆåˆ·æ–°å…³è”çš„è¾“å‡ºæµã€‚æˆ‘ä»¬ä½¿ç”¨tieæ–¹æ³•æ¥å…³è”ä¸¤ä¸ªæµã€‚tieæœ‰ä¸¤ä¸ªé‡è½½çš„ç‰ˆæœ¬ï¼šä¸€ä¸ªç‰ˆæœ¬ä¸å¸¦å‚æ•°ï¼Œè¿”å›æŒ‡å‘è¾“å‡ºæµçš„æŒ‡é’ˆã€‚å¦‚æœæœ¬å¯¹è±¡å½“å‰å·²ç»è¢«å…³è”åˆ°ä¸€ä¸ªè¾“å‡ºæµï¼Œåˆ™è¿”å›çš„å°±æ˜¯æŒ‡å‘è¿™ä¸ªè¾“å‡ºæµçš„æŒ‡é’ˆï¼Œå¦‚æœå¯¹è±¡æœªå…³è”åˆ°æµï¼Œåˆ™è¿”å›çš„æ˜¯ç©ºæŒ‡é’ˆã€‚tieçš„ç¬¬äºŒä¸ªç‰ˆæœ¬æ¥å—ä¸€ä¸ªæŒ‡å‘ostreamçš„æŒ‡é’ˆï¼Œå°†è‡ªå·±å…³è”åˆ°ostreamã€‚

```cpp
cin.tie(&cout); 	// ä»…ç”¨æ¥å±•ç¤ºæ ‡å‡†åº“å°†cinå…³è”åˆ°cout
// old_tieä¸­ä¿å­˜äº†ä¹‹å‰è¢«å…³è”çš„è¾“å‡ºæµ
ostream * old_tie = cin.tie(nullptr);
cin.tie(&cerr);		// å°†cinå…³è”åˆ°cerr
cin.tie(old_tie);	// å°†cinå…³è”åˆ°cout
```

ğŸ’¡æ¯ä¸ªè¾“å…¥æµæœ€å¤šå…³è”åˆ°ä¸€ä¸ªè¾“å‡ºæµï¼Œä½†ä¸€ä¸ªè¾“å‡ºæµå¯ä»¥å…³è”å¤šä¸ªè¾“å…¥æµã€‚

## æ–‡ä»¶è¾“å…¥è¾“å‡º

å¤´æ–‡ä»¶fstreamå®šä¹‰äº†ä¸‰ä¸ªç±»å‹æ¥æ”¯æŒæ–‡ä»¶IOï¼š

- ifstreamä»ä¸€ä¸ªç»™å®šæ–‡ä»¶è¯»å–æ•°æ®
- ofstreamå‘ä¸€ä¸ªç»™å®šæ–‡ä»¶å†™å…¥æ•°æ®
- fstreamé’ˆå¯¹ç»™å®šæ–‡ä»¶è¿›è¡Œè¯»å†™æ•°æ®

**é™¤äº†ä¸Šä¸€ä¸ªè¡¨æ ¼ä¸­çš„å†…å®¹é€šç”¨ä¹‹å¤–ï¼Œfstreamè¿˜é¢å¤–å®šä¹‰äº†ä¸‹é¢çš„æ–¹æ³•ã€‚**

|           æ–¹æ³•           |                             å«ä¹‰                             |
| :----------------------: | :----------------------------------------------------------: |
|     `fstream fstrm`      |                    åˆ›å»ºä¸€ä¸ªæœªç»‘å®šçš„æ–‡ä»¶æµ                    |
|    `fstream fstrm(s)`    | åˆ›å»ºä¸€ä¸ªfstreamï¼Œå¹¶æ‰“å¼€åä¸ºsçš„æ–‡ä»¶ã€‚så¯ä»¥æ˜¯stringç±»å‹æˆ–æŒ‡å‘cé£æ ¼å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚é»˜è®¤çš„æ–‡ä»¶æ¨¡å¼modeä¾èµ–äºfstreamçš„ç±»å‹ |
| `fstream fstrm(s, mode)` |                ä¸ä¸Šé¢ç›¸åŒï¼Œä½†åˆ¶å®šäº†æ‰“å¼€çš„mode                |
|     `fstrm.open(s)`      |            æ‰“å¼€åä¸ºsçš„æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶ä¸fstrmç»‘å®šã€‚            |
|     `fstrm.close()`      |                    å…³é—­ä¸fstrmç»‘å®šçš„æ–‡ä»¶                     |
|    `fstrm.is_open()`     |  è¿”å›ä¸€ä¸ªboolæŒ‡ï¼ŒæŒ‡å‡ºfstrmå…³è”çš„æ–‡ä»¶æ˜¯å¦æˆåŠŸä»£å¼€ä¸”å°šæœªå…³é—­   |

